# voina

# 🎸おことわり
本アプリはチャットボットAPIとして[rinna社が提供するAPI群](https://developers.rinna.co.jp)及び、ヒホ様が提供する[VOICEVOX](https://voicevox.hiroshiba.jp)、ごらんのすぽんさー様が提供する[民安★TALK](https://publish-tool.blogspot.com)を使用します。**各ソフトウェア及びキャラクターの利用規約を熟読の上ご使用下さい。**


# 🤔これは何？
ソフトウェアトーク(VOICEVOX、VOICEROIDなど)とチャットボットAPIを連携する事で、ボイロキャラクターとのおしゃべりを可能にするアプリです。


# 👩‍🔧出来ること
- テキストを直接入力しておしゃべり
- 音声認識機能(Web Speech API)を使用しておしゃべり
- 入力文字列・出力文字列の自動置き換え
  - 主に一人称・二人称の置き換えに使用


# ⚒️使い方(設定)
## rinna Developersのアカウントとサブスクリプションキーの取得
本アプリは[ECCE API](https://developers.rinna.co.jp/product#product=ecce-api)・[CCE API](https://developers.rinna.co.jp/product#product=cce-api)・[AI Model Playground API](https://developers.rinna.co.jp/product#product=ai-model-playground)のいずれかを使用します。利用にはrinna社のアカウント及び各APIのサブスクリプションキーの登録が必要です。


## アプリの起動
本アプリはOSのWebレンダラーを使用します。Windows10を使用している方は[WebView2](https://developer.microsoft.com/ja-jp/microsoft-edge/webview2/)のインストールが必要になる可能性があります。

また、本アプリは初回起動時に実行ファイルと同じディレクトリにコンフィグファイル(config.json)を生成します。一部のウイルス対策ソフト等がアプリをブロックする可能ががあります。

## 『**設定**』タブ
全ての設定は、`コンフィグファイルを上書き`をクリックする事で、`config.json`に保存する事ができます。
また、`コンフィグのデフォルト値をロード`から初期設定を呼び出すことができます。

## 音声合成エンジン設定
音声合成エンジンの設定を行います。

`音声合成エンジンを選択`から`VOICEVOX API`または`民安★TALK(Windows版のみ)`を選択して下さい。

### VOICEVOX APIを使用する場合
特に設定を変更していなければ、VOICEVOXを起動するだけでそのまま使用できます。
- `APIのURL`
  - VOICEVOX APIのURLを入力します。
- `話者一覧を取得`
  - VOICEVOX APIから使用できる話者の一覧を取得します。
- `話者ID`
  - 話者を選択する事ができます。
- `テスト発話`
  - 発話の確認ができます。

### 民安★TALKを使用する場合
**システム環境変数に民安★TALK本体が存在するパスを登録する必要があります。**

コマンドプロンプトに`vrx`と入力し、民安★TALKが起動する状態にして下さい。
- `追加引数`
  - vrxコマンド実行時に追加の引数を設定できます。
- `テスト発話`
  - 発話の確認ができます。

## チャットボットAPI設定
チャットボットAPIの設定を行います。
- `チャットボットAPI`を選択
  - 使用したいチャットボットAPIを選択します。現在は下記の3つから選択出来ます。
    - ECCE API
    - CCE API
    - AI Model Playground API

## ECCE
ECCEの設定を行います。`subscription key`の設定は**必須**です。
- `subscription key`
  - 取得したECCEのサブスクリプションキーを入力します。
- `知識データのファイルID`
  - ECCE APIの`knowledgeId`の値を設定します。
    - アプリから直接知識データをやり取り出来るようにアップデート予定です。
- `L2返却件数・L3返却件数`
  - ECCE APIの`l2ReturnNum`および`l3ReturnNum`の値を設定できます。
- `APIテスト`
  - ECCE APIの動作確認が出来ます。返答は下部にポップアップ表示されます。

## CCE
CCEの設定を行います。`subscription key`の設定は**必須**です。
- `subscription key`
  - 取得したCCEのサブスクリプションキーを入力します。
- `出力の最大トークン長`
  - CCE APIの`outputLength`の値を設定できます。
- `APIテスト`
  - CCE APIの動作確認が出来ます。返答は下部にポップアップ表示されます。

## AI Model Playground
AI Model Playground(AMP)の設定を行います。`subscription key`・`Auth Token`・`Access Token`の設定は**必須**です。
- `subscription key`
  - 取得したAMPのサブスクリプションキーを入力します。
- `Auth Token`
  - 取得したAMPの認証トークンを入力します。認証トークンはサブスクリプションキーとは別に[AI Model Playgroundのアプリ上](https://amp.rinna.jp/Account/Auth)から取得します。
- `Access Token`
  - AMPのアクセストークンを入力します。**サブスクリプションキーおよび認証トークンが適切に設定されていれば、`アクセストークンを取得`をクリックする事でアクセストークンを取得できます。**
  - アクセストークンは一定時間で変更されるので、随時取得し直して下さい。
- `APIテスト`
  - AMPの動作確認が出来ます。返答は下部にポップアップ表示されます。

### 入力テキスト置換設定
入力されたテキストをチャットボットAPIに送信する際、本設定に従いテキストを置換します。上の項目ほど、置換時の優先度が高くなります。

主に、固有名詞を代名詞に変換するのに使用します。(例：`つむぎちゃん→あなた`)

### 出力テキスト置換設定
チャットボットAPIから受け取った返答を音声合成エンジンに送信する際、本設定に従いテキストを置換します。

主に、一人称・二人称の置換に使用します。(チャットボットAPIでは、一人称が`"〈わたし〉"`、二人称が`"〈あなた〉"`で返答されます。)
           
# 🎙️使い方（『**おしゃべりする**』タブ）
### テキスト入力を使う
`送信テキスト`にテキストを入力し、`送信`ボタンをクリックする事で、おしゃべりを行います。
### 音声認識を使う
`音声認識を開始`をクリックすると音声認識エンジンが起動し、直接話しかける事でのおしゃべりが可能になります。(マイクの使用許可が必要な場合があります。)
### おしゃべりの設定
- `音声認識した結果を自動送信する`
  - 音声に区切りが入った際、自動でチャットボットAPIにテキストを送信します。
- `送信テキストを自動で削除`
  - チャットボットAPIにテキストを送信した際、テキストボックス内の文章を削除します。
- `会話履歴に返答を追加しない(ECCEのみ)`
  - ECCEに送付する会話ログにおしゃべりの内容を追加しません。（ECCEは過去2回分の会話履歴を基に返答を生成する機能があります。）
- `会話履歴をクリア`
  - チャットボットAPIに送付する会話ログの内容を初期化します。(CCEでは無効)
- `追加遅延時間(ミリ秒)`
  - 返答が音声合成エンジンに送信された後に追加で待機する時間を設定します。
- `表示を減らす`
  - 一部のUIを非表示にします。

# 💨いっつみー
- [uboar](https://twitter.com/_uboar_)